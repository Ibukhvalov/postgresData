CREATE OR REPLACE PROCEDURE init.create_tables()
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
BEGIN

    CREATE TABLE IF NOT EXISTS data.region (
      id SERIAL PRIMARY KEY,
      name VARCHAR(60) NOT NULL UNIQUE
    );
    
    CREATE TABLE IF NOT EXISTS data.region_postcodes (
      postcode CHAR(6) PRIMARY KEY NOT NULL,
      region_id INTEGER REFERENCES data.region(id) ON DELETE CASCADE
    );
  
   CREATE TABLE IF NOT EXISTS data.child (
      birth_certificate CHAR(6) PRIMARY KEY NOT NULL,
      password VARCHAR(20) NOT NULL,
      full_name VARCHAR(50) NOT NULL,
      birth_date date NOT NULL,
      postcode CHAR(6) NOT NULL REFERENCES data.region_postcodes(postcode) ON DELETE CASCADE,
      number_of_good_deeds INTEGER,
      number_of_misdeeds INTEGER
   );
 
  CREATE TABLE IF NOT EXISTS data.letter (
    author_id CHAR(6) NOT NULL REFERENCES data.child(birth_certificate) ON DELETE CASCADE,
    year INTEGER DEFAULT EXTRACT(YEAR FROM CURRENT_DATE)::INTEGER,
    topic VARCHAR(50) NOT NULL,
    description TEXT,

    PRIMARY KEY (author_id, year)
  );
  
  CREATE TABLE IF NOT EXISTS data.santa (
    region_id INTEGER PRIMARY KEY REFERENCES data.region(id) ON DELETE CASCADE,
    nickname VARCHAR(40) NOT NULL UNIQUE,
    password VARCHAR(40) NOT NULL
  );
   
END;
$$;